\input{../preamble}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[第3讲]{第3讲 中断、异常和系统调用} % The short title appears at the bottom of every slide, the full title is only on the title page
\subtitle{第一节：中断的概念}
\author{向勇、陈渝} % Your name
\institute[清华大学] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
清华大学计算机系 \\ % Your institution for the title page
\medskip
\textit{xyong,yuchen@tsinghua.edu.cn} % Your email address
}
\date{\today} % Date, can be changed to a custom date

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}

%----------------------------------------------------------------------------------------
\begin{frame}
\frametitle{提纲} % Table of contents slide, comment this block out to remove it
\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
\end{frame}

%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------
%------------------------------------------------
\section{第一节：中断的概念}% Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk
%------------------------------------------------

\subsection{背景} % A subsection can be created just before a set of slides with a common theme to further break down your presentation into chunks
%------------------------------------------------
\begin{frame}
	\frametitle{背景}
%	\framesubtitle{xxxx}
    \begin{itemize}
        \item 为什么需要中断、异常和系统调用
        \begin{itemize}
            \item 在计算机运行中，内核是被信任的第三方
            \item 只有内核可以执行特权指令
            \item 方便应用程序
        \end{itemize}
        \item 中断和异常希望解决的问题
        \begin{itemize}
            \item 当外设连接计算机时，会出现什么现象?
            \item 当应用程序处理意想不到的行为时，会出现什么现象?
        \end{itemize}
        \item 系统调用希望解决的问题
        \begin{itemize}
            \item 用户应用程序是如何得到系统服务?
            \item 系统调用和功能调用的不同之处是什么?
        \end{itemize}
    \end{itemize}
\end{frame}
%------------------------------------------------
\begin{frame}
	\frametitle{计算机体系结构概述}
%	\framesubtitle{xxxx}
\begin{figure}
    \includegraphics[width=1.0\linewidth]{architecture}
\end{figure}

\end{frame}
% 2018-lec3-chy.pdf：P3、P4
% 
%------------------------------------------------
\begin{frame}
	\frametitle{SiFive FE310-G002 top-level block diagram}
%	\framesubtitle{xxxx}
\begin{figure}
    \includegraphics[width=0.55\linewidth]{sifive-board}
\end{figure}
\end{frame}
% https://cdn.sparkfun.com/assets/5/b/e/6/2/fe310-g002-ds.pdf
%------------------------------------------------
\subsection{内核的进入与退出}
%------------------------------------------------
\begin{frame}
	\frametitle{内核的进入与退出}
%	\framesubtitle{xxxx}
\begin{figure}
%    \includegraphics[width=0.55\linewidth]{kernel-interrupt}
\end{figure}
\end{frame}
% 2018-lec3-chy.pdf：P31
% 插图
%------------------------------------------------
\subsection{中断、异常和系统调用}
%------------------------------------------------
\begin{frame}
	\frametitle{中断、异常和系统调用}
%	\framesubtitle{xxxx}

    \begin{itemize}
        \item 源头
        \begin{itemize}
            \item 中断:外设
            \item 异常:应用程序意想不到的行为
            \item 系统调用:应用程序请求操作提供服务
        \end{itemize}
        \item 响应方式
        \begin{itemize}
            \item 中断:异步
            \item 异常:同步
            \item 系统调用:异步或同步
        \end{itemize}
        \item 处理机制
        \begin{itemize}
            \item 中断:持续，对用户应用程序是透明的
            \item 异常:杀死或者重新执行意想不到的应用程序指令
            \item 系统调用:等待和持续
        \end{itemize}
    \end{itemize}
\end{frame}
% 2018-lec3-chy.pdf：P25
%------------------------------------------------
\begin{frame}
	\frametitle{RISC-V异常和中断的原因}
%	\framesubtitle{xxxx}
%\begin{figure}
%    \includegraphics[width=0.55\linewidth]{rv-interrupt}
%\end{figure}
\end{frame}
% ref：http://crva.ict.ac.cn/documents/RISC-V-Reader-Chinese-v2p1.pdf
%      p102: rv-interrupt
% rv的中断编号
% 
%------------------------------------------------
\begin{frame}
	\frametitle{中断、异常和系统调用比较}
%	\framesubtitle{xxxx}
    \begin{columns}
    \begin{column}{0.4\textwidth}
        \begin{figure}
%            \includegraphics[width=0.55\linewidth]{kernel-interrupt}
        \end{figure}
    \end{column}
    \begin{column}{0.6\textwidth}
    \begin{itemize}
        \item 源头
	    \begin{itemize}
	       \item 中断:外设
	       \item 异常:应用程序意想不到的行为
	       \item 系统调用:应用程序请求操作提供服务
    	\end{itemize}
        \item 响应方式
	    \begin{itemize}
        	\item 中断:异步
        	\item 异常:同步
        	\item 系统调用:异步或同步
    	\end{itemize}
        \item 处理机制
	    \begin{itemize}
        	\item 中断:持续，对用户应用程序是透明的
        	\item 异常:杀死或者重新执行意想不到的应用程序指令
        	\item 系统调用:等待和持续
    	\end{itemize}
    \end{itemize}
    \end{column}
    \end{columns}
\end{frame}
% 插图2018-lec3-chy.pdf：P32
%------------------------------------------------
\begin{frame}
	\frametitle{中断、异常和系统调用的用途}
	\framesubtitle{xxxx}
    \begin{itemize}
        \item 系统调用(system call)
	    \begin{itemize}
        	\item 应用程序主动向操作系统发出的服务请求
    	\end{itemize}
        \item 异常(exception)
	    \begin{itemize}
        	\item 非法指令或者其他原因导致当前指令执行失败 (如:内存出错)后的处理请求
    	\end{itemize}
        \item 中断(hardware interrupt)
	    \begin{itemize}
        	\item 来自硬件设备的处理请求
    	\end{itemize}
    \end{itemize}
\end{frame}
% 2018-lec3-chy.pdf：P33
%------------------------------------------------
\subsection{中断处理机制}
%------------------------------------------------
\begin{frame}
	\frametitle{中断处理-硬件}
%	\framesubtitle{xxxx}
    \begin{columns}
	    \begin{column}{0.5\textwidth}
        \begin{figure}
%			\includegraphics[width=0.55\linewidth]{xxxx}
% 插图2018-lec3-chy.pdf：P34
        \end{figure}
	    \end{column}
	    \begin{column}{0.5\textwidth}
    \begin{itemize}
        \item 在CPU初始化时设置中断使能标志
	    \begin{itemize}
    	    \item 依据内部或外部事件设置中断标志
    	    \item 依据中断向量调用相应中断服务例程
    	\end{itemize}
    \end{itemize}
	    \end{column}
    \end{columns}
\end{frame}
%------------------------------------------------
\begin{frame}
	\frametitle{中断处理-软件}
%	\framesubtitle{xxxx}
    \begin{columns}
	    \begin{column}{0.5\textwidth}
        \begin{figure}
%			\includegraphics[width=0.55\linewidth]{xxxx}
% 插图2018-lec3-chy.pdf：P35
        \end{figure}
	    \end{column}
	    \begin{column}{0.5\textwidth}
    		\begin{itemize}
    		    \item 现场保存(CPU+编译器)
    		    \item 中断服务处理(服务例程)
    		    \item 清除中断标记(服务例程)
    		    \item 现场恢复(CPU+编译器)
    		\end{itemize}
	    \end{column}
    \end{columns}
\end{frame}
%------------------------------------------------
\begin{frame}
	\frametitle{中断嵌套}
%	\framesubtitle{xxxx}
    \begin{itemize}
        \item 硬件中断服务例程可被打断
	    \begin{itemize}
        	\item 不同硬件中断源可能在硬件中断处理时出现
        	\item 硬件中断服务例程中需要临时禁止中断请求
        	\item 中断请求会保持到CPU做出响应
    	\end{itemize}
        \item 异常服务例程可被打断
	    \begin{itemize}
        	\item 异常服务例程执行时可能出现硬件中断
    	\end{itemize}

        \item 异常服务例程可嵌套
	    \begin{itemize}
        	\item 异常服务例程可能出现缺页
    	\end{itemize}
    \end{itemize}
\end{frame}
% 2018-lec3-chy.pdf：P36
% 硬件中断服务例程可被打断
% 	不同硬件中断源可能在硬件中断处理时出现
% 	硬件中断服务例程中需要临时禁止中断请求
% 	中断请求会保持到CPU做出响应
% 异常服务例程可被打断
% 	异常服务例程执行时可能出现硬件中断
% 异常服务例程可嵌套
% 	异常服务例程可能出现缺页
%----------------------------------------------------------------------------------------

\end{document}
