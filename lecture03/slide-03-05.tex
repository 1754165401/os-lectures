\input{../preamble}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\title[第3讲]{第3讲 进程与调度} % The short title appears at the bottom of every slide, the full title is only on the title page
\subtitle{第五节：教学实验-分时多任务系统}
\author{向勇、陈渝、李国良} % Your name
\institute[清华大学] % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{
清华大学计算机系 \\ % Your institution for the title page
\medskip
\textit{xyong,yuchen,liguoliang@tsinghua.edu.cn} % Your email address
}
\date{\today} % Date, can be changed to a custom date

\begin{document}

\begin{frame}
\titlepage % Print the title page as the first slide
\end{frame}
%----------------------------------------------------------------------------------------
%\begin{frame}
%\frametitle{提纲} % Table of contents slide, comment this block out to remove it
%\tableofcontents % Throughout your presentation, if you choose to use \section{} and \subsection{} commands, these will automatically be printed on this slide as an overview of your presentation
%\end{frame}
%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------

%------------------------------------------------
\section{第五节：教学实验-分时多任务系统}% Sections can be created in order to organize your presentation into discrete blocks, all sections and subsections are automatically printed in the table of contents as an overview of the talk
%------------------------------------------------
\begin{frame}
	\frametitle{系统调用：中断上下文保存与恢复}
    \begin{itemize}
  		\item  TrapContext \href{https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/trap/context.rs\#L4}{结构体}
		\item  \_\_alltraps 的\href{https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/trap/trap.S\#L12}{实现}
		\item 上下文恢复的 \_\_restore 的\href{https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/trap/trap.S\#L40}{实现}
    \end{itemize}	
\end{frame}
%------------------------------------------------
	
% #### 系统调用：中断上下文保存与恢复
% 
% `TrapContext` [结构体](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/trap/context.rs#L4)
% 
% `__alltraps` 的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/trap/trap.S#L12)
% 
% 上下文恢复的 `__restore` 的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/trap/trap.S#L40)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{任务切换：任务上下文(Task Context)}
	\includegraphics[width=0.7\linewidth]{figs/task_context.png}
	\begin{itemize}
	\item TaskContext \href{https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/task/context.rs\#L2}{数据结构}
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 任务切换：任务上下文(Task Context)
% 
% ![task_context](/Users/xyong/github/os-lectures/lecture03/figs/task_context.png)
% 
%  `TaskContext` [数据结构](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/task/context.rs#L2)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 进程切换过程
% 
% ![switch](/Users/xyong/github/os-lectures/lecture03/figs/switch.png)
% 
% `__switch` 的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/task/switch.S#L10)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 进程切换的实现
% 
% 如何进入用户态第一次执行应用程序？
% 
%  `run_next_app` [函数](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch2/os/src/batch.rs#L116)
% 
%  `app_init_context` [函数](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch2/os/src/trap/context.rs#L12)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 多道批处理系统中的程序加载
% 
%  `load_apps` [函数](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/loader.rs#L55)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 进程管理：任务运行状态
% 
% 简单的进程控制块数据结构和三状态进程模型
% 
% ![fsm-coop](/Users/xyong/github/os-lectures/lecture03/figs/fsm-coop.png)
% 
% ```TaskStatus```[数据结构](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/task/task.rs#L13)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 进程管理：任务控制块
% 
% **任务控制块** (Task Control Block)：```TaskControlBlock``` [数据结构](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3-coop/os/src/% task/task.rs#L1)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 协作式调度：主动让出CPU
% 
% 主动调用`sys_yield` 来交出 CPU 使用权。
% 
% ![multiprogramming](/Users/xyong/github/os-lectures/lecture03/figs/multiprogramming.png)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### sys_yield 和 sys_exit
% 
%  `sys_yield` [系统调用](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/user/src/syscall.rs#L27)
% 
% ```sys_yield```的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/syscall/process.rs#L13)
% 
% ```sys_exit```的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/syscall/process.rs#L7)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 第一次进入用户态
% 
% 多进程下的第一次进入用户态；
% 
%  `init_app_cx` 的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/loader.rs#L82)
% 
%  `task::run_first_task` 的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/task/mod.rs#L48)
% 
% ```task::run_next_task```的[实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/task/mod.rs#L82)
% 
%------------------------------------------------
\begin{frame}
	\frametitle{Bullet Points}
	\begin{itemize}
	\item Lorem ipsum dolor sit amet, consectetur adipiscing elit
	\item Aliquam blandit faucibus nisi, sit amet dapibus enim tempus eu
	\item Nulla commodo, erat quis gravida posuere, elit lacus lobortis est, quis porttitor odio mauris at libero
	\item Nam cursus est eget velit posuere pellentesque
	\item Vestibulum faucibus velit a augue condimentum quis convallis nulla gravida
	\end{itemize}
\end{frame}
%------------------------------------------------
% #### 抢占式调度
% 
% `timer` [模块](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/timer.rs#L12)
% 
% `suspend_current_and_run_next` 的[引用](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/trap/mod.rs#L53)和[% 实现](https://github.com/rcore-os/rCore-Tutorial-v3/blob/ch3/os/src/task/mod.rs#L119)
%----------------------------------------------------------------------------------------
\end{document}
