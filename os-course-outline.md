# 教学日历（教学大纲）（48学时）

### 大纲修定历史：

- [v1](https://github.com/LearningOS/os-lectures/blob/c3933c913abdedbda15a25ad85e33f166fae38fc/os-course-outline.md)
- [v2](https://github.com/LearningOS/os-lectures/blob/9ffa747971086b88f8045b04ae012c82ad837414/os-course-outline.md)：2020年10月21日提交给系里的版本；
- [v3](https://github.com/LearningOS/os-lectures/blob/e00265613daeafffa9fa4d1a53def7b5ed92016a/os-course-outline.md): 21 Oct 2020
- [v4](https://github.com/LearningOS/os-lectures/blob/1d07e4bfc55af586079499db65f926b52c0afeb1/os-course-outline.md): cooperate with 2021-spring labs
- [v5](https://github.com/LearningOS/os-lectures/blob/f001a6c5bacc7be80e27a168959c288c91ec1639/os-course-outline.md): 2021年秋季学期结束时更新教学内容部分
- v6: Current for 2022 spring

### 课程组织与基本目的

操作系统是计算机系统中负责管理各种软硬件资源的核心系统软件，掌握操作系统的基本原理及其设计实现技术是研究型大学计算机专业本科毕业生的基本要求。

本课程是计算机专业核心课，从计算机系统的视角进行内容组织与调整，以教学操作系统uCore/rCore和risc-v CPU为实验环境，讲授操作系统的概念、基本原理和实现技术，并介绍部分当前操作系统研究热点和论文，帮助学生了解和掌握大型复杂系统软件的分析方法和核心设计思路，并为学生充分利用操作系统功能进行应用软件研究和开发打下扎实的基础。

下面的每一讲是三个课时

### 建议与要求

- 逻辑性和实验相关性有折衷
- 内容有点分散
- 多核是否要加强和贯穿？
- ppt: 风格不一致 Latex, ppt, 统一：中文，用markdown [Why Slidev | Slidev](https://sli.dev/guide/why.html)
- 增加基于Linux的用户态编程和程序展示
- 搭环境的过程，助教提供（文档或视频）
- 原则：与实验一致，不存在1.5次的情况， 比如 进程 + 调度 2次课， 1或2次课对应着1章，可以通过深入讲解来确保上课时间用满。
- 要加实验（缺页异常的处理） ，练习：各种置换算法 (模拟算法)
- 在合适的地方讲解多核的内容(第8讲开始)
- 左文字，右图
- 每次课的知识点明确
- 加页码
- 标明出处（代码，文档，图片等）
- rt-book-v3每章的练习要改

### 评分

- 选择1： 实验一~~五：40% 期中+期末：60%
- 选择2： 一个月内完成实验一~~五：40% 扩展实验（大实验，课程设计）：60%

### 教学内容

#### 1. 操作系统概述

##### 知识点：教学要求和安排、操作系统的定义、操作系统结构、Linux的使用

##### 基本内容

1. 课程概述&教学安排
1. 什么是操作系统 定义/分类/抽象/特征
1. 操作系统历史演化
1. 操作系统结构
1. UNIX/Linux类应用分析

##### 核心学习成效

 1. 掌握操作系统的定义：能从软件角度、资源管理角度定义操作系统及其所属范围
 1. 掌握操作系统的抽象：理解进程、文件、地址空间的抽象对象以及与硬件关系
 1. 掌握操作系统的特征：理解并发/并行、共享、虚拟化、异步的含义
 1. 掌握操作系统的历史：理解单用户系统、批处理系统、多道程序系统、分时系统、个人计算机、SMP系统、VMM系统、分布式系统中的操作系统特征
 1. 掌握操作系统的架构：理解简单单体/分层单体/复杂单体/微/外/VMM kernel的特点
 1. 掌握 计算机硬件与操作系统的关系：理解硬件与操作系统之间的interface和各自的主要工作

##### 能力检测方法

 1. 能分析硬件的哪些功能能够给操作系统提供哪些支持
 1. 能对一个计算机系统中的软硬件的特征、区别、关系、运行状态进行清晰判断
 1. 对操作系统有一个完整的总体分析
 1. 能够理解/编写/运行基本的UNIX类程序  
 1. 能在Linux环境下进行操作和编程
#### 2. 实验介绍

##### 知识点：实验内容、要求和建议；系统启动；编译过程；搭建自己的实验环境和熟悉流程

##### 基本内容
1. 简介rcore-tutorial-v3（站在应用/OS的角度理解rt-v3）
   1. 库级支持
   2. 批处理支持
   3. 多道程序与分时多任务
   4. 支持地址空间
   5. 支持文件系统
   6. 支持进程间通信
   7. 并发支持
   8. 管理I/O设备
2. 编译
   1. 通用的编译
3. 启动
   1. 通用计算机的启动
4. 实验：应用程序与基本执行环境
   1. 基本环境搭建
   2. RV基本组成
   3. QEMU模拟器
   4. QEMU启动
   5. 程序内存布局
   6. 编译流程

##### 核心学习成效
1. 理解操作系统实验设计的基本思路
1. 理解操作系统提供的实验要达到的基本目标
1. 理解函数调用的设计与执行细节
1. 理解硬件启动
1. 理解程序的执行过程
##### 能力检测方法

1. 能够搭建实验环境
1. 能够理解和重现rcore-tutorial-v3的chapter1中提供OS实例
1. 能够Debug OS实例 
1. 理解如何编写裸机程序
1. 能够完成 rt-v3::chpater1的章练习
#### 3. 特权级

##### 知识点：特权级/系统调用/异常、RV的特权级/系统调用/异常、批处理

##### 基本内容

1. 从OS角度看看应用程序
1. 从OS角度看计算机系统
1. 从OS角度再理解RISC-V
1. kernel mode操作系统
1. 实验：批处理操作系统
   1. 应用程序设计
   1. 加载应用程序
   1. 特权级切换
##### 核心学习成效
1. 理解特权级
1. 理解软件如何面向特权级进行编程
1. 理解系统调用的设计与实现
1. 理解批处理操作系统的设计与实现
1. 理解程序/批处理操作系统的执行过程
##### 能力检测方法
1. 说明系统调用的原理
1. 描述基于RV硬件/和软件协调实现系统调用
1. 分析并编程举例如果不遵守特权级约束会产生的后果：异常
1. 能够完成 rt-v3::chpater2的章练习
#### 4. 多道程序与分时多任务
##### 知识点：中断、上下文、任务/中断上下文、任务/中断上下文切换、任务/中断上下文切换的时机、任务生命周期、任务执行过程
##### 基本内容
1. 多道程序概念
1. 分时多任务概念
1. 协作式调度
1. 抢占式调度
1. 中断处理
1. 实验：多道程序与分时多任务
   1. 上下文切换
   1. 协作式调度
   1. 中断机制
   1. 抢占式调度
##### 核心学习成效
1. 什么是任务（进程的初级阶段）
1. 能描述任务生命周期的状态转换关系和时机

##### 能力检测方法
1. 能够完成 rt-v3::chpater3的章练习
#### 5. 地址空间-物理内存管理
##### 知识点：内存管理、连续物理内存分配、非连续物理内存分配
##### 基本内容
1. 计算机体系结构和内存层次
1. 静态内存分配
1. 动态内存分配（连续内存分配算法）
1. 地址空间
1. 页式存储管理
1. 实验：地址空间
   1. 管理sv39多级页表
   1. 内核与应用的地址空间
   1. 基于地址空间的分时多任务
1. 页表自映射（option）
##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater4的章练习
#### 6. 地址空间-虚拟存储管理
##### 知识点：局部性原理、虚拟存储基本概念、Page Fault异常、局部页面置换算法、全局页面置换算法
##### 基本内容
1. 局部性原理
1. 覆盖和交换
1. 虚拟页式存储
1. RISC-V 缺页异常
1. 页面置换算法的概念
1. 最优算法、先进先出算法和最近最久未使用算法
1. 时钟置换算法和最不常用算法
1. Belady现象和局部置换算法比较
1. 全局页面置换算法
1. 工作集置换算法
1. 缺页率置换算法

##### 核心学习成效

##### 能力检测方法
#### 7. 进程管理与单处理器调度
##### 知识点：进程概念、进程运行状态、进程的管理、基本调度策略/算法
##### 基本内容
1. 进程概念
1. 进程管理
1. 系统调用
1. 实验：进程管理
   1. 应用示例ji
   1. 进程的数据结构
   1. 进程管理机制的实现
1. 单处理机调度
1. 处理机调度概念
1. 调度准则
1. 调度算法
1. 实时调度
1. 优先级反置问题与解决方法（option：可放在在同步互斥后讲解）
##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater5的章练习
#### 8. 多处理器调度
##### 知识点：多处理器调度策略/算法
##### 基本内容
1. 对称多处理与多核架构
1. 多处理器调度策略
1. 多处理器调度机制
1. O(1) 调度（option）
1. CFS调度（option）
1. BFS调度算法（option）
##### 核心学习成效

##### 能力检测方法
#### 9. 文件系统
##### 知识点：文件系统基本概念、文件组织、文件系统设计与实现
##### 基本内容
1. 文件系统概述
1. 文件系统接口
1. 文件系统实现(涉及 VFS)
1. 实验：文件系统
   1. easyfs简介
   1. 块设备接口
   1. 块缓冲层
   1. 磁盘布局与管理
   1. 索引节点
   1. 在内核中接入easy-fs
1. 实例：进程文件系统 procfs（option）
##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater6的章练习
#### 10. 进程间通信
##### 知识点： 信号、管道、消息队列、共享内存、I/O重定向
##### 基本内容
1. 进程通信概念
1. 信号
1. 管道
1. 消息队列
1. 共享内存
1. 实验：进程间通信与I/O重定向
   1. 标准I/O
   1. 管道
   1. 命令行参数与I/O重定向
1. D-Bus机制（option）
1. Binder机制（option）
##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater7的章练习
#### 11. 线程与协程
##### 知识点：线程、协程
##### 基本内容
1. 线程
   1. 线程
   2. 用户线程、内核线程
   3. 线程与进程的关系
   4. 实验：线程实现
2. 协程

##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater8的章练习
   
#### 12. 同步互斥
##### 知识点：基于软件的同步互斥方法、基于硬件的同步互斥方法、信号量、管程、基于信号量/管程的经典同步问题、死锁、死锁的解决方法、优先级反置与解决方法
##### 基本内容
1. 现实生活中的同步问题
1. 临界区
1. 禁用硬件中断
1. 基于软件的解决方法
1. 更高级的抽象方法
1. 信号量
1. 管程
1. 哲学家就餐问题（信号量/管程）
1. 读者-写者问题（信号量/管程）
1. 死锁概念
1. 死锁处理方法
1. 银行家算法
1. 死锁检测
1. 并发错误检测（option）
1. 实验：并发
   1. 锁机制实现
   2. 信号量机制
   3. 条件变量机制
2. 优先级反置问题与解决方法（option：可放在这里讲解，不一定放在调度一节）
3. 同步互斥-RCU(option)
##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater8的章练习
#### 13. I/O设备管理
##### 知识点：I/O抽象、I/O特征、DMA/Interrupt/轮询机制、同步I/O、异步I/O
##### 基本内容
1. 设备概述
1. 设备抽象
1. 设备执行模型
1. 实验：I/O设备管理
   1. 外设平台
   1. 串口驱动
   1. virtio设备驱动
##### 核心学习成效

##### 能力检测方法
1. 能够完成 rt-v3::chpater9的章练习
#### 14. 扩展主题（可靠文件系统，多核优化，高级语言支持，请外校专家讲）
##### 知识点： 基于日志的文件系统设计
##### 基本内容
OPTION1:可靠文件系统主题：

1. 系统可靠性概述
1. 基于日志的文件系统
1. FAT文件系统（option）
1. EXT4文件系统（option）
1. NTFS（option）
1. Zettabyte File System (ZFS)（option）
1. 数据库文件系统（option）

##### 核心学习成效

##### 能力检测方法
### 教学实验

#### 实验一：操作系统的基本支持

覆盖：1/2/3章

知识点：计算机/OS启动、特权级切换、系统调用、应用程序/库/内核的关系、特权级相关异常、任务切换

##### 用户态
- 显示目录文件名 
    - 实现一个Linux应用程序ls，能显示当前目录中的文件。
- 显示调用栈 
    - 实现一个linux应用程序，能打印出调用栈信息
- 显示目录信息
- 睡眠
    - 实现一个rcore应用程序，用sleep系统调用睡眠一段时间（in rcore tutorial v3 Branch 2022spring）
  
     

##### 内核态
- 显示调用栈
    - 实现裸机程序，能打印调用栈
- 实现新系统调用get_taskinfo
    - 增加get_taskinfo系统调用，能显示task的id和task name
- 统计系统调用
   - 实现内核扩展，能够统计应用执行过程中系统调用编号和次数
- 统计时间
  - 实现内核扩展，能够统计应用执行的完成时间
- 分析异常
  - 统计执行异常的程序的异常情况说明（主要是各种特权级涉及的异常）
  - 能够打印异常程序的调用栈
#### 实验二：地址空间

覆盖：4章

知识点：地址空间、应用与内核之间在不同地址空间的数据交互/控制交互、内存/地址相关异常（如缺页异常）

##### 用户态
- linux应用访问内存相关系统调用
  - 使用sbrk，mmap,munmap,mprotect系统调用 
##### 内核态

- 改进系统调用sys_get_time
   - 引入虚存机制后，原来内核的 sys_get_time 函数实现就无效了。请你重写这个函数，恢复其正常功能。
- 实现新系统调用mmap, munmap
   - 请实现 mmap 和 munmap 系统调用
- 实现新系统调用sbrk
   - 请实现 sbrk系统调用

#### 实验三：进程管理与调度

覆盖：5章

知识点：进程管理的关联性和必要性、调度算法

##### 用户态
- 实现一个与进程管理相关的linux应用程序
  - 能用nice,fork,exec,spawn等系统调用
##### 内核态
- 实现新系统调用 spawn
- 实现一个调度算法-如：stride

#### 实验四：文件系统与进程间通信

覆盖：6，7章

知识点：文件系统的实现、进程间通信机制

##### 用户态
- 实现一个应用程序能体现文件/进程间通信的特点
 
##### 内核态
- 扩展文件系统功能
   - 扩大单个文件的大小
      - 支持三重间接inode
   - 扩展mmap系统调用，支持对文件的映射
      - 这样对内存读写，其实就是对文件读写
   - 支持crash一致性（hard）
     -  扩展log fs
- 实现一个文件相关系统调用相关
   - 实现硬链接相关系统调用
   - 实现创建目录的系统调用
- 实现一个新的重定向能力
   - 实现共享内存
#### 实验五：同步互斥
覆盖：8章

知识点：线程，同步互斥的机制，解决同步互斥问题，死锁，优先级反转问题。
##### 用户态
- 实现一个Linux线程应用程序能体现线程属性和线程间同步互斥的特点
  - 使用了pthread_* 系统调用
##### 内核态

- 扩展内核功能：内核线程
  -  在内核中支持内核线程
- 在内核线程中支持同步互斥机制
  - 实现内核线程用的mutex, semaphore, cond-var
- 扩展内核功能：多核支持
  - 扩展rcore-tutorial-v3运行在多核系统中 
- 用银行家算法解决死锁问题
  - 设计某种资源申请导致死锁的例子
  - 设计银行家算法来避免死锁问题
- 解决优先级反转问题
  - 实现RM实时调度算法
  - 设计优先级反转的实例
  - 实现优先级天花板和优先级继承方法 


#### 扩展实验 （即大实验，课程设计）

（一个月完成实验1~5后，可选择完成扩展实验来代替考试）

实现新feature的支持(游戏等)

涉及：参加比赛、支持多核、支持设备驱动、支持树莓派/SiFive等（与老师协商）
